---
layout: default
---

<!-- <div style="display: block; text-align: center;">
  <div style="font-size:smaller; background-color:honeydew; font-style: italic;">欢迎关注我的微信公众号，请搜<b><u>愚千一</u></b>或直接输入ID： Yuqianyi1001。<br>
    组织《共读阿含》中，<a href="/join-group-requirements/" target="_blank"><b>入群须知(必读)</b></a> ，加入群聊请加我微信：yuqianyi1002<br>
    海外的朋友请<a href="mailto:jeffwoo2019@gmail.com" target="_blank">Email</a>我，有Line和Telegram群组。</div>
</div> -->

<div id="d_tags_cn">
  {% assign all_tags = "" | split: "|" %}
  
  {%- for post in site.posts -%}
    {%- if post.url contains "zh-tw" -%}
      <!-- do nothing -->
    {%- else -%}

      {%- assign all_tags = all_tags | concat: post.tags -%}
    {%- endif -%}
  {%- endfor -%}
  
  {%- assign unique_tags = all_tags | uniq | sort -%}
    
    {%- for tag in unique_tags -%}
      {%- assign tag_count = 0 -%}
      {%- for tagged_post in site.posts -%}
        {%- unless tagged_post.url contains "zh-tw" -%}
          {%- if tagged_post.tags and tagged_post.tags contains tag -%}
            {%- assign tag_count = tag_count | plus: 1 -%}
          {%- endif -%}
        {%- endunless -%}
      {%- endfor -%}
      <input type="checkbox" style="margin-right: 5px;" id="{{ tag }}" name="{{ tag }}" value="{{ tag }}" />
      <label for="{{ tag }}" style="font-size: smaller;">{{ tag }} ({{ tag_count }})</label>
    {%- endfor -%}
</div>

<!-- 繁體标签不再单独展示；保持单一标签集，文字由前端转换 -->

<div class="row">
  
{% assign zh_tw_count = site.posts | where_exp: "post", "post.url contains 'zh-tw'" | size %}
{% assign total_posts = site.posts.size | minus: zh_tw_count %}

<h2 style="font-size: large;">文章列表 (共{{ total_posts }}篇，倒序排列，最新的文章在最前面)</h2>

<div class="posts posts-zh-cn" style="display:block;">
  <ol>
    {%- for post in site.posts -%}
      {%- unless post.url contains "zh-tw" -%}
      <li class="post">
        
            <a href="{{ site.baseurl }}{{ post.url }}" class="read-more" id="post_title">{{ post.title }}</a>
            <a href="{{ post.wechat }}" target="_blank" id="wechat_link"><img src="/wechat.ico" width="16px" /></a>
            <img src="/copy.png" width="16px" id="copy-button" />
            <br>
            <span style="font-size:medium;" id="post-desc">{{ post.description }}</span>
            {%- for tag in post.tags -%}
              <code style="font-size: smaller;">{{ tag }}</code>
            {%- endfor -%}
          
      </li>
      {%- endunless -%}
    {%- endfor -%}
  </ol>
</div>

<div class="posts posts-zh-tw" style="display:none;">
  <ol>
    {%- for post in site.posts -%}
      {%- if post.url contains "zh-tw" -%}
      <li class="post">
        <ul>
          <li>
            <img src="/zh-trandition.png" width="18px" />
            <a href="{{ site.baseurl }}{{ post.url }}" class="read-more" id="post_title">{{ post.title }}</a>
            {%- if post.wechat -%}
            <a href="{{ post.wechat }}" target="_blank" id="wechat_link"><img src="/wechat.ico" width="16px" /></a>
            {%- endif -%}
            <img src="/copy.png" width="16px" id="copy-button" />
            <br>
            <span style="font-size:medium;" id="post-desc">{{ post.description }}</span>
            {%- for tag in post.tags -%}
              <code style="font-size: smaller;">{{ tag }}</code>
            {%- endfor -%}
          </li>
        </ul>
      </li>
      {%- endif -%}
    {%- endfor -%}
  </ol>
</div>

  </div>


  <script>
    const toggleCheckbox = document.getElementById('toggle-switch');

    function getLang() {
      return localStorage.getItem('lang') || 'zh-CN';
    }

    // language view controlled globally via conversion; no per-section toggling needed

    // respond to global toggle updates
    window.addEventListener('langchange', function(e) {
      const lang = (e && e.detail && e.detail.lang) ? e.detail.lang : getLang();
      if (typeof window.updatePostsVisibility === 'function') {
        window.updatePostsVisibility();
      }
    });

    // Copy button for visible posts
    const copyButtons = document.querySelectorAll('.posts img#copy-button');
    copyButtons.forEach((button) => {
      button.addEventListener('click', function() {
        const listItem = button.closest('ul');
        const postTitle = listItem.querySelector('#post_title').innerText;
        const wechatLink = listItem.querySelector('#wechat_link');
        const postHref = wechatLink ? wechatLink.getAttribute('href') : '';
        const postDesc = listItem.querySelector('#post-desc').innerText;

        const tempTextarea = document.createElement('textarea');
        tempTextarea.value = `【原创】${postTitle}\n${postHref}\n ${postDesc}`;
        document.body.appendChild(tempTextarea);
        tempTextarea.select();
        document.execCommand('copy');
        document.body.removeChild(tempTextarea);
        button.src = '/success.png';
        setTimeout(function() { button.src = '/copy.png'; }, 1000);
      });
    });

    // Tags: sort and filter per language
    document.addEventListener('DOMContentLoaded', function() {
      const TAG_CONTAINER_ID = 'd_tags_cn';

      function sortTagContainer(containerId) {
        const container = document.getElementById(containerId);
        if (!container) return;
        const items = Array.from(container.querySelectorAll('label')).map(label => {
          const m = label.textContent.match(/\((\d+)\)/);
          const count = m ? parseInt(m[1], 10) : 0;
          return { label, count };
        });
        items.sort((a, b) => b.count - a.count);
        items.forEach(({ label }) => {
          container.appendChild(label.previousElementSibling);
          container.appendChild(label);
        });
      }

      sortTagContainer(TAG_CONTAINER_ID);

      const checkboxSelector = `#${TAG_CONTAINER_ID} input[type="checkbox"]`;

      window.updatePostsVisibility = function updatePostsVisibility() {
        const lang = getLang();
        const checkboxes = document.querySelectorAll(checkboxSelector);
        const checkedTags = Array.from(checkboxes).filter(cb => cb.checked).map(cb => cb.value);
        const scope = document.querySelector('.posts-zh-cn');
        const posts = scope ? scope.querySelectorAll('.post') : [];

        if (checkedTags.length > 0) {
          posts.forEach(post => {
            const postTagTexts = Array.from(post.querySelectorAll('code')).map(code => code.textContent.trim());
            const postTagTextsCN = (lang === 'zh-TW' && window.cnConv)
              ? postTagTexts.map(t => window.cnConv(t))
              : postTagTexts;
            const isPostVisible = checkedTags.some(tag => postTagTextsCN.includes(tag));
            post.classList.toggle('hidden', !isPostVisible);
          });
        } else {
          posts.forEach(post => {
            post.classList.remove('hidden');
          });
        }
      };

      // attach listeners
      document.querySelectorAll(checkboxSelector).forEach(checkbox => {
        checkbox.addEventListener('change', window.updatePostsVisibility);
      });

      window.updatePostsVisibility();
    });
  </script>

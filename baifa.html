---
layout: individual
title: 百法交互表
---

<style>
  .baifa-wrap {
    margin: 24px auto;
    max-width: 1400px;
    padding: 0 12px;
  }

  .baifa-table {
    margin-top: 50px;
    border-collapse: collapse;
    table-layout: fixed;
    width: 100%;
  }

  .baifa-table td {
    border: 1px solid #333;
    padding: 8px;
    vertical-align: middle;
  }

  .title-cell {
    background: #d9d9d9;
    font-size: 24px;
    font-weight: 700;
    letter-spacing: 4px;
    text-align: center;
    text-orientation: upright;
    writing-mode: vertical-rl;
  }

  .category {
    font-size: 20px;
    font-weight: 700;
    text-align: left;
  }

  .category.vertical {
    text-align: center;
    text-orientation: upright;
    writing-mode: vertical-rl;
  }

  .category.heart {
    background: #dfead4;
  }

  .category.heart-assoc {
    background: #f2b5b8;
  }

  .category.color {
    background: #b8c0f2;
  }

  .category.nonconcurrent {
    background: #f2c5f5;
  }

  .category.unconditioned {
    background: #f6f06b;
  }

  .subcategory {
    background: #e7b188;
    font-size: 18px;
    font-weight: 700;
    text-align: left;
  }

  .subcategory2 {
    background: #e7b188;
    font-size: 15px;
    font-weight: 700;
    text-align: left;
  }

  .items-cell {
    background: #e6eef8;
  }

  .items-cell.alt {
    background: #f7f1d3;
  }

  .items {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
  }

  .item-btn {
    background: #8b4a1e;
    border: 1px solid #6b3310;
    border-radius: 4px;
    color: #fff;
    cursor: pointer;
    font-size: 14px;
    padding: 4px 8px;
    white-space: nowrap;
  }

  .items-heart .item-btn {
    background: #e6f2d8;
    border-color: #b7cf94;
    color: #2f3a20;
  }

  .items-neutral .item-btn {
    background: #d8ddd6;
    border-color: #b5beb2;
    color: #2c332c;
  }

  .items-wholesome .item-btn {
    background: #d1f6c8;
    border-color: #86c974;
    color: #1e451c;
  }

  .items-affliction-root .item-btn {
    background: #3f0d0d;
    border-color: #2b0707;
    color: #f7eaea;
  }

  .items-affliction-small .item-btn {
    background: #4f1717;
    border-color: #3a1010;
    color: #f7ecec;
  }

  .items-affliction-medium .item-btn {
    background: #5f2424;
    border-color: #461a1a;
    color: #f7eded;
  }

  .items-affliction-large .item-btn {
    background: #6f3131;
    border-color: #532424;
    color: #f7eeee;
  }

  .items-affliction-indeterminate .item-btn {
    background: #7f3e3e;
    border-color: #5f2c2c;
    color: #f8efef;
  }

  .items-color .item-btn {
    background: #d9defa;
    border-color: #9ea9e2;
    color: #273055;
  }

  .items-nonconcurrent .item-btn {
    background: #f7d7f9;
    border-color: #d5a6d9;
    color: #5a2a5f;
  }

  .items-unconditioned .item-btn {
    background: #fff4a8;
    border-color: #d9cb5a;
    color: #4a3d00;
  }

  .item-btn.is-highlighted {
    background: #d93025;
    border-color: #b3261e;
    box-shadow: 0 0 0 2px rgba(217, 48, 37, 0.55), 0 4px 10px rgba(0, 0, 0, 0.25);
    color: #fff;
  }

  .item-btn.is-highlighted-buddha {
    background: #64d466;
    border-color: #2f9b3b;
    box-shadow: 0 0 0 2px rgba(47, 155, 59, 0.55), 0 4px 10px rgba(0, 0, 0, 0.25);
    color: #0d2b15;
  }

  .baifa-tools {
    background: #f2ede3;
    border: 1px solid #c8bb9c;
    border-radius: 8px;
    margin: 18px 0 0;
    padding: 12px 14px;
  }

  .baifa-tools-title {
    font-size: 16px;
    font-weight: 700;
    margin: 0 0 8px;
  }

  .baifa-tools-actions {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }

  .baifa-tools-btn {
    background: #6a4b2a;
    border: 1px solid #4f371f;
    border-radius: 6px;
    color: #fff;
    cursor: pointer;
    font-size: 14px;
    padding: 6px 12px;
  }

  .baifa-tools-btn[aria-pressed="true"] {
    background: #3f2a12;
    border-color: #2d1d0c;
  }

  .baifa-modal {
    background: transparent;
    display: none;
    inset: 0;
    pointer-events: none;
    position: fixed;
    z-index: 1000;
  }

  .baifa-modal.active {
    display: block;
  }

  .baifa-modal-content {
    background: #d2d1d1;
    border: 2px solid #a5a4a4;
    border-radius: 8px;
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.25);
    font-weight: 400;
    max-height: 80vh;
    max-width: 720px;
    overflow: auto;
    padding: 8px 18px 20px;
    position: absolute;
    pointer-events: auto;
    /* width: min(720px, 92vw); */
  }

  .baifa-modal-title {
    cursor: move;
    padding: 5px;
    background: #949393;
    border-radius: 4px;
    user-select: none;
    font-size: 18px;
    font-weight: 700;
    margin: 0 64px 10px 0;
  }

  .baifa-modal-desc {
    font-size: 15px;
    line-height: 1.1;
    margin: 0;
    white-space: normal;
  }

  .baifa-modal-close,
  .baifa-modal-copy {
    align-items: center;
    background: transparent;
    border: none;
    border-radius: 6px;
    color: #4f371f;
    cursor: pointer;
    display: inline-flex;
    height: 24px;
    justify-content: center;
    padding: 0;
    position: absolute;
    top: 6px;
    width: 24px;
  }

  .baifa-modal-copy {
    right: 36px;
  }

  .baifa-modal-close {
    right: 8px;
  }

  .baifa-modal-close:hover,
  .baifa-modal-copy:hover {
    background: #b8b7b7;
  }

  .baifa-modal-close:focus-visible,
  .baifa-modal-copy:focus-visible {
    outline: 2px solid #4f371f;
    outline-offset: 2px;
  }

  .baifa-modal-copy.is-copied {
    color: #2f5d3a;
  }

  .baifa-modal-copy.is-failed {
    color: #7a2b2b;
  }

  .baifa-modal-icon {
    fill: none;
    height: 16px;
    stroke: currentColor;
    stroke-linecap: round;
    stroke-linejoin: round;
    stroke-width: 2;
    width: 16px;
  }

  .baifa-section-title {
    display: block;
    font-size: 16px;
    font-weight: 600;
    margin: 12px 0 4px;
  }

  .baifa-section-title:first-child {
    margin-top: 0;
  }

  .baifa-section-body {
    display: block;
    font-weight: 400;
    margin: 0 0 8px;
  }
</style>

<div class="baifa-wrap">
  <table class="baifa-table">
    <colgroup>
      <col style="width: 60px;">
      <col style="width: 50px;">
      <col style="width: 50px;">
      <col style="width: 110px;">
      <col>
    </colgroup>
    <tbody>
      <tr>
        <td class="title-cell" rowspan="12">大乘百法明门论</td>
        <td class="category heart" colspan="3">心法(8)</td>
        <td class="items-cell alt">
          <div class="items items-heart">
            <button type="button" class="item-btn">1.眼识</button>
            <button type="button" class="item-btn">2.耳识</button>
            <button type="button" class="item-btn">3.鼻识</button>
            <button type="button" class="item-btn">4.舌识</button>
            <button type="button" class="item-btn">5.身识</button>
            <button type="button" class="item-btn">6.意识</button>
            <button type="button" class="item-btn">7.末那识</button>
            <button type="button" class="item-btn">8.阿赖耶识</button>
          </div>
        </td>
      </tr>
      <tr>
        <td class="category heart-assoc" rowspan="8"><span class="category vertical">心所有法</span>(51)</td>
        <td class="subcategory" colspan="2">遍行(5)</td>
        <td class="items-cell">
          <div class="items items-neutral">
            <button type="button" class="item-btn">9.作意</button>
            <button type="button" class="item-btn">10.触</button>
            <button type="button" class="item-btn">11.受</button>
            <button type="button" class="item-btn">12.想</button>
            <button type="button" class="item-btn">13.思</button>
          </div>
        </td>
      </tr>
      <tr>
        <td class="subcategory" colspan="2">别境(5)</td>
        <td class="items-cell alt">
          <div class="items items-neutral">
            <button type="button" class="item-btn">14.欲</button>
            <button type="button" class="item-btn">15.胜解</button>
            <button type="button" class="item-btn">16.念</button>
            <button type="button" class="item-btn">17.定</button>
            <button type="button" class="item-btn">18.慧</button>
          </div>
        </td>
      </tr>
      <tr>
        <td class="subcategory" colspan="2">善法(11)</td>
        <td class="items-cell">
          <div class="items items-wholesome">
            <button type="button" class="item-btn">19.信</button>
            <button type="button" class="item-btn">20.精进</button>
            <button type="button" class="item-btn">21.惭</button>
            <button type="button" class="item-btn">22.愧</button>
            <button type="button" class="item-btn">23.无贪</button>
            <button type="button" class="item-btn">24.无嗔</button>
            <button type="button" class="item-btn">25.无痴</button>
            <button type="button" class="item-btn">26.轻安</button>
            <button type="button" class="item-btn">27.不放逸</button>
            <button type="button" class="item-btn">28.行舍</button>
            <button type="button" class="item-btn">29.不害</button>
          </div>
        </td>
      </tr>
      <tr>
        <td class="subcategory" colspan="2">根本烦恼(6)</td>
        <td class="items-cell alt">
          <div class="items items-affliction-root">
            <button type="button" class="item-btn">30.贪</button>
            <button type="button" class="item-btn">31.嗔</button>
            <button type="button" class="item-btn">32.痴</button>
            <button type="button" class="item-btn">33.慢</button>
            <button type="button" class="item-btn">34.疑</button>
            <button type="button" class="item-btn">35.不正见</button>
          </div>
        </td>
      </tr>
      <tr>
        <td class="subcategory" rowspan="3"><span class="category vertical">随烦恼</span>(20)</td>
        <td class="subcategory2">小随烦恼(10)</td>
        <td class="items-cell">
          <div class="items items-affliction-small">
            <button type="button" class="item-btn">36.忿</button>
            <button type="button" class="item-btn">37.恨</button>
            <button type="button" class="item-btn">38.覆</button>
            <button type="button" class="item-btn">39.恼</button>
            <button type="button" class="item-btn">40.诳</button>
            <button type="button" class="item-btn">41.谄</button>
            <button type="button" class="item-btn">42.憍</button>
            <button type="button" class="item-btn">43.害</button>
            <button type="button" class="item-btn">44.嫉</button>
            <button type="button" class="item-btn">45.悭</button>
          </div>
        </td>
      </tr>
      <tr>
        <td class="subcategory2">中随烦恼(2)</td>
        <td class="items-cell alt">
          <div class="items items-affliction-medium">
            <button type="button" class="item-btn">46.无惭</button>
            <button type="button" class="item-btn">47.无愧</button>
          </div>
        </td>
      </tr>
      <tr>
        <td class="subcategory2">大随烦恼(8)</td>
        <td class="items-cell">
          <div class="items items-affliction-large">
            <button type="button" class="item-btn">48.不信</button>
            <button type="button" class="item-btn">49.懈怠</button>
            <button type="button" class="item-btn">50.放逸</button>
            <button type="button" class="item-btn">51.昏沈</button>
            <button type="button" class="item-btn">52.掉举</button>
            <button type="button" class="item-btn">53.失念</button>
            <button type="button" class="item-btn">54.不正知</button>
            <button type="button" class="item-btn">55.散乱</button>
          </div>
        </td>
      </tr>
      <tr>
        <td class="subcategory" colspan="2">不定烦恼(4)</td>
        <td class="items-cell alt">
          <div class="items items-affliction-indeterminate">
            <button type="button" class="item-btn">56.睡眠</button>
            <button type="button" class="item-btn">57.恶作</button>
            <button type="button" class="item-btn">58.寻</button>
            <button type="button" class="item-btn">59.伺</button>
          </div>
        </td>
      </tr>
      <tr>
        <td class="category color" colspan="3">色法(11)</td>
        <td class="items-cell">
          <div class="items items-color">
            <button type="button" class="item-btn">60.眼</button>
            <button type="button" class="item-btn">61.耳</button>
            <button type="button" class="item-btn">62.鼻</button>
            <button type="button" class="item-btn">63.舌</button>
            <button type="button" class="item-btn">64.身</button>
            <button type="button" class="item-btn">65.色</button>
            <button type="button" class="item-btn">66.声</button>
            <button type="button" class="item-btn">67.香</button>
            <button type="button" class="item-btn">68.味</button>
            <button type="button" class="item-btn">69.触</button>
            <button type="button" class="item-btn">70.法处所摄色</button>
          </div>
        </td>
      </tr>
      <tr>
        <td class="category nonconcurrent" colspan="3">心不相应行法(24)</td>
        <td class="items-cell alt">
          <div class="items items-nonconcurrent">
            <button type="button" class="item-btn">71.得</button>
            <button type="button" class="item-btn">72.命根</button>
            <button type="button" class="item-btn">73.众同分</button>
            <button type="button" class="item-btn">74.异生性</button>
            <button type="button" class="item-btn">75.无想定</button>
            <button type="button" class="item-btn">76.灭尽定</button>
            <button type="button" class="item-btn">77.无想报</button>
            <button type="button" class="item-btn">78.名身</button>
            <button type="button" class="item-btn">79.句身</button>
            <button type="button" class="item-btn">80.文身</button>
            <button type="button" class="item-btn">81.生</button>
            <button type="button" class="item-btn">82.住</button>
            <button type="button" class="item-btn">83.老</button>
            <button type="button" class="item-btn">84.无常</button>
            <button type="button" class="item-btn">85.流转</button>
            <button type="button" class="item-btn">86.定异</button>
            <button type="button" class="item-btn">87.相应</button>
            <button type="button" class="item-btn">88.势速</button>
            <button type="button" class="item-btn">89.次第</button>
            <button type="button" class="item-btn">90.时</button>
            <button type="button" class="item-btn">91.方</button>
            <button type="button" class="item-btn">92.数</button>
            <button type="button" class="item-btn">93.和合性</button>
            <button type="button" class="item-btn">94.不和合性</button>
          </div>
        </td>
      </tr>
      <tr>
        <td class="category unconditioned" colspan="3">无为法(6)</td>
        <td class="items-cell">
          <div class="items items-unconditioned">
            <button type="button" class="item-btn">95.虚空</button>
            <button type="button" class="item-btn">96.择灭</button>
            <button type="button" class="item-btn">97.非择灭</button>
            <button type="button" class="item-btn">98.不动</button>
            <button type="button" class="item-btn">99.想受灭</button>
            <button type="button" class="item-btn">100.真如</button>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
  <div class="baifa-tools" aria-label="心和心所的相应关系">
    <div class="baifa-tools-title">心和心所的相应关系</div>
    <div class="baifa-tools-actions">
      <button type="button" class="baifa-tools-btn" id="baifa-highlight-senses" aria-pressed="false">
        前五识相应心所
      </button>
      <button type="button" class="baifa-tools-btn" id="baifa-highlight-sixth" aria-pressed="false">
        意识相应心所
      </button>
      <button type="button" class="baifa-tools-btn" id="baifa-highlight-manas" aria-pressed="false">
        末那识相应心所
      </button>
      <button type="button" class="baifa-tools-btn" id="baifa-highlight-alaya" aria-pressed="false">
        阿赖耶识相应心所
      </button>
      <button type="button" class="baifa-tools-btn" id="baifa-highlight-buddha" aria-pressed="false">
        成佛后的相应心所
      </button>
    </div>
  </div>
</div>

<div class="baifa-modal" id="baifa-modal" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="baifa-modal-content">
    <button type="button" class="baifa-modal-copy" id="baifa-modal-copy" aria-label="复制" title="复制">
      <svg class="baifa-modal-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <rect x="9" y="9" width="10" height="10" rx="2"></rect>
        <rect x="5" y="5" width="10" height="10" rx="2"></rect>
      </svg>
    </button>
    <button type="button" class="baifa-modal-close" id="baifa-modal-close" aria-label="关闭" title="关闭">
      <svg class="baifa-modal-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <path d="M6 6l12 12M18 6l-12 12"></path>
      </svg>
    </button>
    <h3 class="baifa-modal-title" id="baifa-modal-title"></h3>
    <div class="baifa-modal-desc" id="baifa-modal-desc"></div>
  </div>
</div>

<script src="{{ site.baseurl }}/assets/js/interact.min.js"></script>
<script src="{{ site.baseurl }}/assets/js/js-yaml.min.js"></script>
<script src="{{ site.baseurl }}/assets/js/baifa-sources.js"></script>
<script>
  const modal = document.getElementById('baifa-modal');
  const modalContent = document.querySelector('.baifa-modal-content');
  const modalTitle = document.getElementById('baifa-modal-title');
  const modalDesc = document.getElementById('baifa-modal-desc');
  const modalCopy = document.getElementById('baifa-modal-copy');
  const modalClose = document.getElementById('baifa-modal-close');
  const buttons = Array.from(document.querySelectorAll('.item-btn'));
  const senseHighlightButton = document.getElementById('baifa-highlight-senses');
  const sixthHighlightButton = document.getElementById('baifa-highlight-sixth');
  const manasHighlightButton = document.getElementById('baifa-highlight-manas');
  const alayaHighlightButton = document.getElementById('baifa-highlight-alaya');
  const buddhaHighlightButton = document.getElementById('baifa-highlight-buddha');
  const senseMindIds = new Set([
    9, 10, 11, 12, 13,
    14, 15, 16, 17, 18,
    19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29,
    30, 31, 32,
    46, 47,
    48, 49, 50, 51, 52, 53, 54, 55,
  ]);
  const manasMindIds = new Set([
    9, 10, 11, 12, 13,
    18,
    30, 32, 33, 35,
    48, 49, 50, 51, 52, 53, 54, 55,
  ]);
  const alayaMindIds = new Set([9, 10, 11, 12, 13]);
  const buddhaMindIds = createIdRangeSet(9, 29);
  const allMindIds = createIdRangeSet(9, 59);
  const highlightButtons = [
    { button: senseHighlightButton, ids: senseMindIds },
    { button: sixthHighlightButton, ids: allMindIds },
    { button: manasHighlightButton, ids: manasMindIds },
    { button: alayaHighlightButton, ids: alayaMindIds },
    { button: buddhaHighlightButton, ids: buddhaMindIds, highlightClass: 'is-highlighted-buddha' },
  ];
  const highlightClasses = ['is-highlighted', 'is-highlighted-buddha'];
  let dataPromise = null;
  let lastAnchor = null;
  let hasUserDragged = false;
  let activeHighlightButton = null;

  function getYamlCandidates() {
    const candidates = [];
    const pageUrl = window.location.href;
    const isFile = window.location.protocol === 'file:';
    if (isFile) {
      candidates.push(new URL('data/baifa.yaml', pageUrl).toString());
    } else {
      candidates.push(new URL('/data/baifa.yaml', window.location.origin).toString());
      candidates.push(new URL('data/baifa.yaml', pageUrl).toString());
    }
    candidates.push('data/baifa.yaml');
    return Array.from(new Set(candidates));
  }

  async function fetchYamlText() {
    const urls = getYamlCandidates();
    let lastError = null;
    for (const url of urls) {
      try {
        const response = await fetch(url, { cache: 'no-cache' });
        if (!response.ok) {
          throw new Error(`Failed to load ${url}: ${response.status}`);
        }
        return await response.text();
      } catch (error) {
        lastError = error;
      }
    }
    throw lastError || new Error('Failed to load YAML.');
  }

  function parseYaml(yamlText) {
    if (!window.jsyaml || typeof window.jsyaml.load !== 'function') {
      throw new Error('js-yaml not loaded');
    }
    const data = window.jsyaml.load(yamlText) || {};
    if (Array.isArray(data)) {
      return data;
    }
    return Array.isArray(data.items) ? data.items : [];
  }

  function getItemId(text) {
    const match = text.trim().match(/^(\d+)/);
    return match ? Number(match[1]) : null;
  }

  function getItemName(text) {
    return text.replace(/^\d+/, '').trim();
  }

  function createIdRangeSet(start, end) {
    const ids = new Set();
    for (let i = start; i <= end; i += 1) {
      ids.add(i);
    }
    return ids;
  }

  function clearHighlights() {
    buttons.forEach((button) => {
      highlightClasses.forEach((highlightClass) => {
        button.classList.remove(highlightClass);
      });
    });
  }

  function applyHighlight(ids, highlightClass = 'is-highlighted') {
    buttons.forEach((button) => {
      const id = getItemId(button.textContent || '');
      highlightClasses.forEach((itemClass) => {
        button.classList.remove(itemClass);
      });
      if (id && ids.has(id)) {
        button.classList.add(highlightClass);
      }
    });
  }

  function escapeHtml(text) {
    return String(text)
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/\"/g, '&quot;')
      .replace(/'/g, '&#39;');
  }

  function renderSources(sources) {
    if (!sources || !sources.length) {
      return '<div class=\"baifa-section-body\">暂无解释。</div>';
    }
    const orderedSources = window.baifaSortSources ? window.baifaSortSources(sources) : sources;
    const htmlParts = [];
    for (const source of orderedSources) {
      if (source.title) {
        htmlParts.push(`<div class=\"baifa-section-title\">${escapeHtml(source.title)}</div>`);
      }
      if (source.content) {
        htmlParts.push(`<div class=\"baifa-section-body\">${escapeHtml(source.content).replace(/\\n/g, '<br>')}</div>`);
      }
    }
    return htmlParts.join('');
  }

  function loadBaifaData() {
    if (!dataPromise) {
      dataPromise = fetchYamlText().then((yamlText) => parseYaml(yamlText));
    }
    return dataPromise;
  }

  function positionModal(anchor) {
    if (!anchor) {
      return;
    }
    if (hasUserDragged) {
      return;
    }
    const rect = anchor.getBoundingClientRect();
    const modalRect = modalContent.getBoundingClientRect();
    const gap = 8;
    const margin = 8;
    let left = rect.left;
    let top = rect.bottom + gap;

    left = Math.max(margin, Math.min(left, window.innerWidth - modalRect.width - margin));
    top = Math.max(margin, Math.min(top, window.innerHeight - modalRect.height - margin));
    modalContent.style.left = `${left}px`;
    modalContent.style.top = `${top}px`;
  }

  function openModal(title, content, anchor) {
    modalTitle.textContent = title;
    if (Array.isArray(content)) {
      modalDesc.innerHTML = renderSources(content);
    } else {
      const text = content || '暂无解释。';
      modalDesc.innerHTML = `<div class=\"baifa-section-body\">${escapeHtml(text)}</div>`;
    }
    modal.classList.add('active');
    modal.setAttribute('aria-hidden', 'false');
    hasUserDragged = false;
    lastAnchor = anchor || lastAnchor;
    positionModal(lastAnchor);
  }

  function closeModal() {
    modal.classList.remove('active');
    modal.setAttribute('aria-hidden', 'true');
  }

  function getModalCopyText() {
    const titleText = modalTitle.textContent ? modalTitle.textContent.trim() : '';
    const descText = modalDesc.innerText ? modalDesc.innerText.trim() : '';
    return [titleText, descText].filter(Boolean).join('\n\n');
  }

  function setCopyButtonState(state) {
    if (!modalCopy) {
      return;
    }
    modalCopy.classList.remove('is-copied', 'is-failed');
    if (state === 'copied') {
      modalCopy.classList.add('is-copied');
      modalCopy.setAttribute('aria-label', '已复制');
      modalCopy.setAttribute('title', '已复制');
      return;
    }
    if (state === 'failed') {
      modalCopy.classList.add('is-failed');
      modalCopy.setAttribute('aria-label', '复制失败');
      modalCopy.setAttribute('title', '复制失败');
      return;
    }
    modalCopy.setAttribute('aria-label', '复制');
    modalCopy.setAttribute('title', '复制');
  }

  async function copyModalText() {
    const text = getModalCopyText();
    if (!text) {
      return;
    }
    try {
      if (navigator.clipboard && navigator.clipboard.writeText) {
        await navigator.clipboard.writeText(text);
      } else {
        const textarea = document.createElement('textarea');
        textarea.value = text;
        textarea.setAttribute('readonly', '');
        textarea.style.position = 'absolute';
        textarea.style.left = '-9999px';
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
      }
      setCopyButtonState('copied');
      window.setTimeout(() => {
        setCopyButtonState('default');
      }, 1200);
    } catch (error) {
      setCopyButtonState('failed');
      window.setTimeout(() => {
        setCopyButtonState('default');
      }, 1200);
    }
  }

  buttons.forEach((button) => {
    button.addEventListener('click', async () => {
      const rawText = button.textContent || '';
      const id = getItemId(rawText);
      if (!id) {
        return;
      }
      const name = getItemName(rawText);
      try {
        const data = await loadBaifaData();
        const items = Array.isArray(data) ? data : (data && data.items) || [];
        const item = items.find((entry) => Number(entry.id) === id);
        const titleText = item && item.name ? item.name : name;
        const title = `第${id}法：${titleText}`;
        const sources = item && item.sources ? item.sources : [];
        openModal(title, sources, button);
      } catch (error) {
        openModal(`${id} ${name}`, '解释加载失败，请稍后重试。', button);
      }
    });
  });

  if (modalCopy) {
    modalCopy.addEventListener('click', copyModalText);
  }
  modalClose.addEventListener('click', closeModal);
  document.addEventListener('keydown', (event) => {
    if (event.key === 'Escape') {
      closeModal();
    }
  });
  if (window.interact) {
    window.interact(modalContent).draggable({
      allowFrom: '.baifa-modal-title',
      listeners: {
        move(event) {
          const margin = 8;
          const rect = modalContent.getBoundingClientRect();
          const currentLeft = Number.parseFloat(modalContent.style.left) || rect.left;
          const currentTop = Number.parseFloat(modalContent.style.top) || rect.top;
          const maxLeft = window.innerWidth - rect.width - margin;
          const maxTop = window.innerHeight - rect.height - margin;
          const left = Math.min(Math.max(margin, currentLeft + event.dx), maxLeft);
          const top = Math.min(Math.max(margin, currentTop + event.dy), maxTop);
          hasUserDragged = true;
          modalContent.style.left = `${left}px`;
          modalContent.style.top = `${top}px`;
        },
      },
    });
  }
  window.addEventListener('resize', () => {
    if (modal.classList.contains('active')) {
      positionModal(lastAnchor);
    }
  });
  window.addEventListener('scroll', () => {
    if (modal.classList.contains('active')) {
      positionModal(lastAnchor);
    }
  }, { passive: true });

  function updateHighlightButtons() {
    highlightButtons.forEach(({ button }) => {
      if (!button) {
        return;
      }
      button.setAttribute('aria-pressed', button === activeHighlightButton ? 'true' : 'false');
    });
  }

  highlightButtons.forEach(({ button, ids }) => {
    if (!button) {
      return;
    }
    button.addEventListener('click', () => {
      if (activeHighlightButton === button) {
        activeHighlightButton = null;
        clearHighlights();
        updateHighlightButtons();
        return;
      }
      const config = highlightButtons.find((entry) => entry.button === button);
      applyHighlight(ids, (config && config.highlightClass) || 'is-highlighted');
      activeHighlightButton = button;
      updateHighlightButtons();
    });
  });
</script>
